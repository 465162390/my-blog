<!-- 天气预报组件 -->
<template>
  <div class="weather">
    <div class="location">
      <svg viewBox="0 0 1024 1024" width="16" height="16"><path d="M512 959.469288c-10.69969 0-16.60519-1.283226-20.36584-5.689582-2.261507-2.64934-229.644237-272.535093-290.237267-403.232784-21.890566-46.818305-33.44267-97.655134-33.44267-147.265018 0-187.090049 154.331971-339.226005 344.045777-339.226005s344.045777 153.187915 344.045777 341.429183c0 56.871265-10.660804 99.841939-36.789904 148.300604C747.006362 687.675068 534.795169 950.618713 532.675902 953.24247c-2.532683 3.166109-7.055696 6.227842-20.145829 6.227842L512 959.470311zM512 272.403087c-72.959685 0-132.325771 59.365062-132.325771 132.325771S439.040315 537.054629 512 537.054629s132.325771-59.365062 132.325771-132.325771S584.959685 272.403087 512 272.403087z" fill="#707070"></path></svg>
      <span style="vertical-align: 3px;">{{search.location}}</span>
    </div>

    <div class="now">
      <img :src="nowImg">
      <div class="now-content">
        <span class="now-txt">{{now.cond_txt}}</span>
        <span class="now-tmp">{{now.tmp}}°</span>
      </div>
    </div>

    <div class="dis">
      <div class="el-row" style="margin-bottom: 0.5em;">
        <span class="el-col-6">空气</span>
        <span class="el-col-6">{{air.qlty}}</span>
        <span class="el-col-6">PM2.5</span>
        <span class="el-col-6">{{air.pm25}}</span>
      </div>
      <div class="el-row" style="margin-bottom: 0.5em;">
        <span class="el-col-6">{{now.wind_dir}}</span>
        <span class="el-col-6">{{now.wind_sc}}级</span>
        <span class="el-col-6">降水量</span>
        <span class="el-col-6">{{now.pcpn}}mm</span>
      </div>
      <div class="el-row">
        <span class="el-col-6">湿度</span>
        <span class="el-col-6">{{now.hum}}%</span>
        <span class="el-col-6">压强</span>
        <span class="el-col-6">{{now.pres}}hpa</span>
      </div>
    </div>

    <hr style="width: 85%">

    <div class="dis forecast el-row">
      <div class="el-col-8" v-for="(forecast, index) in forecasts" :key="forecast.index">
        <span>{{days[index]}}</span>
        <span><img :src="imgs[index]"></span>
        <span>{{forecast.tmp_min}}°/{{forecast.tmp_max}}°</span>
      </div>
    </div>

    <hr style="width: 85%">

    <div class="dis live el-row">
      <div class="el-col-8">
        <span><svg viewBox="0 0 1024 1024" width="42" height="42"><path fill="#17abe3" d="M761.12 208H616c-2.4 48.96-48 88-104 88s-101.36-39.04-104-88H262.88L112 358.64 225.36 472 264 433.12V864h496V433.12L798.64 472 912 358.64z"></path></svg>
        </span>
        <span v-if="liveStyle.length != 0">{{liveStyle[1].brf}}</span>        
      </div>
      <div class="el-col-8">
        <span><svg viewBox="0 0 1024 1024" width="42" height="42"><path d="M888.921535 135.083581C843.919599 90.076528 784.084838 65.290005 720.438263 65.290005s-123.480312 24.786523-168.482249 69.788459L135.084605 551.954991C90.076528 596.957951 65.290005 656.791687 65.290005 720.438263c0 63.645552 24.786523 123.480312 69.789483 168.477133 45.001937 45.007053 104.835673 69.793576 168.482249 69.793576 63.645552 0 123.480312-24.786523 168.482249-69.788459l416.871409-416.876526c45.007053-45.00296 69.793576-104.836697 69.793576-168.483272C958.708971 239.915162 933.922449 180.080401 888.921535 135.083581zM414.609902 831.490521c-29.659507 29.659507-69.099774 45.998637-111.048165 45.998637-41.949414 0-81.388658-16.33913-111.053282-46.00273-29.659507-29.659507-45.998637-69.099774-45.998637-111.048165 0-41.949414 16.33913-81.388658 46.003753-111.048165l169.973206-169.975253c46.831608 30.604018 161.736615 113.150036 222.664266 221.531466L414.609902 831.490521zM831.486428 414.608879 637.012202 609.085152c-65.002456-105.065917-168.45462-183.976128-223.206618-220.989113l195.584514-195.58656c29.659507-29.659507 69.099774-45.998637 111.048165-45.998637s81.388658 16.33913 111.048165 45.998637l0.005117 0.005117c29.659507 29.658484 45.997614 69.098751 45.997614 111.047142C877.489158 345.510128 861.151052 384.949372 831.486428 414.608879zM628.545366 295.435663c13.875009 13.880125 13.875009 36.377512 0 50.256614l-48.511877 48.5129c-6.940063 6.934946-16.037255 10.404977-25.128307 10.404977-9.091052 0-18.188244-3.470031-25.128307-10.404977-13.875009-13.880125-13.875009-36.376489 0-50.256614l48.511877-48.5129C592.168878 281.56577 614.665241 281.56577 628.545366 295.435663zM710.380186 213.617216c7.510044 7.510044 11.877515 17.97028 11.877515 28.731368 0 10.657734-4.367471 21.11797-11.877515 28.732391-7.516184 7.511067-18.074657 11.877515-28.732391 11.877515-10.662851 0-21.11797-4.366448-28.732391-11.877515-7.515161-7.614421-11.877515-18.074657-11.877515-28.732391 0-10.762111 4.362354-21.221324 11.877515-28.731368 7.614421-7.614421 18.069541-11.878538 28.732391-11.878538C692.305529 201.738677 702.865026 206.002794 710.380186 213.617216z" fill="#17abe3"></path></svg>
        </span>
        <span v-if="liveStyle.length != 0">{{liveStyle[2].brf}}</span>
      </div>
      <div class="el-col-8">
        <span><svg viewBox="0 0 1024 1024" width="42" height="42"><path d="M508.426103 959.480544c-119.92944 0-232.674247-46.703695-317.478701-131.507126-84.811618-84.803431-131.514289-197.548238-131.514289-317.478701s46.702672-232.688573 131.514289-317.479725C275.744693 108.211561 388.49564 61.495586 508.426103 61.495586c119.930463 0 232.67527 46.715975 317.479725 131.520429 175.049828 175.064155 175.049828 459.895295 0 634.957403C741.101373 912.777873 628.356566 959.480544 508.426103 959.480544zM508.426103 142.052297c-98.413404 0-190.94075 38.337143-260.516362 107.919918-69.595055 69.581752-107.918895 162.109098-107.918895 260.522502 0 98.401124 38.324864 190.92847 107.912755 260.521478 69.595055 69.584821 162.109098 107.907639 260.522502 107.907639 98.416474 0 190.92847-38.322817 260.525572-107.907639 143.634328-143.646608 143.634328-377.396349 0-521.045003C699.354574 180.38944 606.827227 142.052297 508.426103 142.052297z" p-id="10004" fill="#17abe3"></path><path d="M190.633247 792.55986c-19.660782 0-36.870746-14.409175-39.800471-34.44244-3.225461-22.014386 12.008498-42.467207 34.016745-45.692668 129.633453-18.97312 262.046205-98.466616 363.291097-218.095203 80.623225-95.240131 133.906779-207.841675 150.020782-317.072449 3.238764-22.001083 23.587208-37.328164 45.731554-33.95944 22.002107 3.252067 37.210483 23.718191 33.95944 45.732577-18.276249 123.876332-78.026074 250.794953-168.220283 357.350804C495.878322 680.773891 345.308025 770.350023 196.519304 792.141328 194.54023 792.428877 192.573435 792.55986 190.633247 792.55986z" p-id="10005" fill="#17abe3"></path><path d="M555.930023 930.36032c-2.780323 0-5.599532-0.287549-8.417717-0.890276-21.765723-4.627391-35.650965-26.025747-31.021527-47.777143 22.655999-106.476033-9.702989-215.943191-86.562495-292.817022-77.461209-77.44893-187.624215-109.637026-294.757211-86.140892-21.725814 4.680603-43.215244-8.994861-47.967478-30.720675-4.765537-21.724791 8.981559-43.201941 30.714536-47.974641 134.063345-29.382191 271.994788 10.921747 368.968399 107.880009 96.235808 96.252181 136.76385 233.265718 108.403942 366.527814C591.251483 917.38275 574.534753 930.36032 555.930023 930.36032z" p-id="10006" fill="#17abe3"></path><path d="M800.206516 616.462167c-104.877629 0-206.190059-41.209564-282.286178-117.307729-96.237855-96.251158-136.76692-233.265718-108.405989-366.515534 4.641717-21.765723 26.077935-35.703153 47.777143-31.022551 21.765723 4.628414 35.650965 26.02677 31.021527 47.778166-22.655999 106.464777 9.704013 215.931934 86.562495 292.803719 77.447906 77.44893 187.664124 109.703541 294.742884 86.141916 21.699208-4.746094 43.215244 8.981559 47.986921 30.706349 4.761444 21.739117-8.979512 43.214221-30.705326 47.987944C858.028433 613.367689 828.987003 616.462167 800.206516 616.462167z" fill="#17abe3"></path></svg>
        </span>
        <span v-if="liveStyle.length != 0">{{liveStyle[3].brf}}</span>
      </div>
    </div>
  </div>
</template>

<script>
import { weather } from '@/utils/toolKeys'
import { getNow } from '@/api/weather'
import { getForecast } from '@/api/weather'
import { getLiveStyle } from '@/api/weather'
import { getAir } from '@/api/weather'

export default {
  name: 'Weather',
  data () {
    return {
      search: {
        key: weather.key,
        location: this.$store.state.ipInfo.city,
      },
      now: {},
      air: {},
      nowImg: "",
      imgs: [],
      days: ["今天", "明天", "后天"],
      forecasts: [],
      liveStyle: [],
    };
  },

  created() {
    // 实时天气
    getNow(this.search).then(response => {
      let { now } = response.HeWeather6[0]
      this.now = now;
      this.nowImg = "../../../static/img/weather/" + now.cond_code + ".png";
    })

    // 未来3天天气
    getForecast(this.search).then(response => {
      let { daily_forecast } = response.HeWeather6[0]
      this.forecasts = daily_forecast;
      this.imgs[0] = "../../../static/img/weather/" + daily_forecast[0].cond_code_d + ".png";  // 今天图标
      this.imgs[1] = "../../../static/img/weather/" + daily_forecast[1].cond_code_d + ".png";  // 明天图标
      this.imgs[2] = "../../../static/img/weather/" + daily_forecast[2].cond_code_d + ".png";  // 后天图标
    })

    // 生活指数
    getLiveStyle(this.search).then(response => {
      let { lifestyle } = response.HeWeather6[0]
      this.liveStyle = lifestyle;
    })

    // 空气质量
    getAir(this.search).then( response => {
      let { air_now_city } = response.HeWeather6[0]
      this.air = air_now_city
    })
  },

  components: {},

  computed: {},

  methods: {}
}

</script>
<style scoped>
.weather {
  margin-top: 30px;
  width: 100%;
  height: 480px;
  border-radius: 10px;
  border: 0.1rem solid rgb(213, 213, 213);
  background-color: rgb(255, 255, 255);
  -webkit-transition: all 0.2s linear;
  transition: all 0.2s linear;
  color: darkslategrey;
  font-size: 15px;
  text-align: left;
  box-sizing: border-box;
}
.weather:hover {
  -webkit-transform: translate(0, -2px);
  transform: translate(0, -2px);
  -webkit-box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
  box-shadow: 10px 10px 20px rgba(0, 0, 0, 0.3);
}
.location {
  padding: 10px;
  vertical-align: middle;
}
.now {
  text-align: center;
}
.now img {
  width: 4.2em;
  margin: .2em 1em .2em 0;
}
.now-content {
  display: inline-block;
  padding: 0px; 
  vertical-align: 6px;
}
.now-content .now-txt {
  display: block;
  font-size: 1.4em;
  text-align: left;
}
.now-content .now-tmp {
  font-size: 2em;
}
.dis {
  padding: 1em 0.8em;
  text-align: center;
}
.forecast img {
  width: 3em;
}
.forecast span {
  display: block;
}
.live span {
  display: block;
}
@media (max-width: 1600px) {
  .weather {
    font-size: 13px;
    height: 410px;
  }
}
</style>